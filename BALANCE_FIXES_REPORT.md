# üîß –ó–í–Ü–¢ –ü–†–û –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø –õ–û–ì–Ü–ö–ò –ë–ê–õ–ê–ù–°–Ü–í

## üö® **–ó–ù–ê–ô–î–ï–ù–Ü –ö–†–ò–¢–ò–ß–ù–Ü –ü–†–û–ë–õ–ï–ú–ò**

### 1. **–î–£–ë–õ–Æ–í–ê–ù–ù–Ø –¢–†–ê–ù–ó–ê–ö–¶–Ü–ô**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å–µ—Ä–≤–µ—Ä–∞ frontend –º—ñ–≥ –ø–æ–≤—Ç–æ—Ä–Ω–æ –æ–±—Ä–æ–±–∏—Ç–∏ —Ç—É –∂ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é
**–ü—Ä–∏—á–∏–Ω–∞**: –í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥—É–±–ª—é–≤–∞–Ω–Ω—è
**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: ‚úÖ –î–æ–¥–∞–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É `isTransactionProcessed()` –ø–µ—Ä–µ–¥ –æ–±—Ä–æ–±–∫–æ—é

### 2. **RACE CONDITIONS**
**–ü—Ä–æ–±–ª–µ–º–∞**: –ú—ñ–∂ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –±–∞–ª–∞–Ω—Å—É —Ç–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó –º–æ–≥–ª–∏ —Å—Ç–∞—Ç–∏—Å—è —ñ–Ω—à—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ–∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –∑ JSON —Ñ–∞–π–ª–∞–º–∏
**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: ‚úÖ –ó–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ SQLite –∑ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è–º–∏

### 3. **–í–Ü–î–°–£–¢–ù–Ü–°–¢–¨ –ö–û–ú–Ü–°–Ü–ô**
**–î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è**: USDT/USDC –ù–ï –ú–ê–Æ–¢–¨ –∫–æ–º—ñ—Å—ñ–π –∑–∞ –¥–µ–ø–æ–∑–∏—Ç
**–í–∏—Å–Ω–æ–≤–æ–∫**: ‚úÖ –ö–æ–º—ñ—Å—ñ—ó –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω—ñ - —Ç—ñ–ª—å–∫–∏ gas fee –∑–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é

### 4. **JSON –§–ê–ô–õ–ò –Ø–ö –ë–ê–ó–ê –î–ê–ù–ò–•**
**–ü—Ä–æ–±–ª–µ–º–∏**:
- ‚ùå –ù–µ–º–∞—î —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- ‚ùå Race conditions
- ‚ùå –í—Ç—Ä–∞—Ç–∞ –¥–∞–Ω–∏—Ö –ø—Ä–∏ –∑–±–æ—è—Ö
- ‚ùå –ù–µ–º–∞—î —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è**: ‚úÖ –ü–æ–≤–Ω—ñ—Å—Ç—é –∑–∞–º—ñ–Ω–µ–Ω–æ –Ω–∞ SQLite –±–∞–∑—É –¥–∞–Ω–∏—Ö

## üõ†Ô∏è **–í–ò–ö–û–ù–ê–ù–Ü –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø**

### 1. **–°—Ç–≤–æ—Ä–µ–Ω–æ –±–∞–∑—É –¥–∞–Ω–∏—Ö SQLite**
```javascript
// database/db.js
- –¢–∞–±–ª–∏—Ü—è users (–∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ)
- –¢–∞–±–ª–∏—Ü—è balances (–±–∞–ª–∞–Ω—Å–∏)
- –¢–∞–±–ª–∏—Ü—è transactions (—Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó)
- –¢–∞–±–ª–∏—Ü—è withdrawal_requests (–∑–∞—è–≤–∫–∏ –Ω–∞ –≤–∏–≤—ñ–¥)
```

### 2. **–ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó**
```javascript
// –ê—Ç–æ–º–∞—Ä–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –±–∞–ª–∞–Ω—Å—É
const transaction = dbManager.db.transaction(() => {
  Object.entries(balances).forEach(([token, amount]) => {
    dbManager.updateBalance(userAddress, token, parseFloat(amount), 'set');
  });
});
```

### 3. **–ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—é**
```javascript
// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —á–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—è –≤–∂–µ –æ–±—Ä–æ–±–ª–µ–Ω–∞
if (dbManager.isTransactionProcessed(txHash)) {
  console.log(`‚ö†Ô∏è Transaction ${txHash} already processed`);
  return;
}
```

### 4. **–ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ª–æ–≥—ñ–∫–∞ –¥–µ–ø–æ–∑–∏—Ç—ñ–≤**
```javascript
// –ê–¢–û–ú–ê–†–ù–ê –û–ü–ï–†–ê–¶–Ü–Ø:
// 1. –ó–±–µ—Ä—ñ–≥–∞—î–º–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—é (–∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –¥—É–±–ª—é–≤–∞–Ω–Ω—è)
// 2. –¢—ñ–ª—å–∫–∏ –ø—ñ—Å–ª—è —É—Å–ø—ñ—à–Ω–æ–≥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –Ω–∞—Ä–∞—Ö–æ–≤—É—î–º–æ –±–∞–ª–∞–Ω—Å
// 3. –ü–æ–∫–∞–∑—É—î–º–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–Ω—è
```

### 5. **–û–Ω–æ–≤–ª–µ–Ω—ñ API endpoints**
- ‚úÖ `/api/sync-balances` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö
- ‚úÖ `/api/balances/:userAddress` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö
- ‚úÖ `/api/save-transaction` - –∑ –ø–µ—Ä–µ–≤—ñ—Ä–∫–æ—é –¥—É–±–ª—é–≤–∞–Ω–Ω—è
- ‚úÖ `/api/user-transactions/:userAddress` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö
- ‚úÖ `/api/withdrawal-requests/:userAddress` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö

### 6. **–û–Ω–æ–≤–ª–µ–Ω–∏–π Telegram Bot**
- ‚úÖ `updateUserBalances()` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö
- ‚úÖ `saveWithdrawalRequestToDatabase()` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö
- ‚úÖ `updateWithdrawalStatusInDatabase()` - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –±–∞–∑—É –¥–∞–Ω–∏—Ö

## üìä **–ü–ï–†–ï–í–ê–ì–ò –ù–û–í–û–á –°–ò–°–¢–ï–ú–ò**

### ‚úÖ **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**
- –ê—Ç–æ–º–∞—Ä–Ω—ñ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ—ó
- –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—é
- –¶—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö

### ‚úÖ **–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å**
- –®–≤–∏–¥–∫–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –¥–∞–Ω–∏—Ö
- –Ü–Ω–¥–µ–∫—Å–∏ –¥–ª—è –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó
- WAL —Ä–µ–∂–∏–º –¥–ª—è SQLite

### ‚úÖ **–ú–∞—Å—à—Ç–∞–±–æ–≤–∞–Ω—ñ—Å—Ç—å**
- –ü—ñ–¥—Ç—Ä–∏–º–∫–∞ –±–∞–≥–∞—Ç—å–æ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –ï—Ñ–µ–∫—Ç–∏–≤–Ω—ñ –∑–∞–ø–∏—Ç–∏
- –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å –º—ñ–≥—Ä–∞—Ü—ñ—ó –Ω–∞ PostgreSQL

### ‚úÖ **–ë–µ–∑–ø–µ–∫–∞**
- –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π–Ω–∞ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å
- –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è race conditions
- –õ–æ–≥—É–≤–∞–Ω–Ω—è –≤—Å—ñ—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π

## üîÑ **–ú–Ü–ì–†–ê–¶–Ü–Ø –î–ê–ù–ò–•**

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è
- –ü—Ä–∏ –ø–µ—Ä—à–æ–º—É –∑–∞–ø—É—Å–∫—É —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü—ñ
- JSON —Ñ–∞–π–ª–∏ –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è
- –ù–æ–≤—ñ –¥–∞–Ω—ñ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö

### –†—É—á–Ω–∞ –º—ñ–≥—Ä–∞—Ü—ñ—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
```javascript
// –ú–æ–∂–Ω–∞ –¥–æ–¥–∞—Ç–∏ —Å–∫—Ä–∏–ø—Ç –¥–ª—è –º—ñ–≥—Ä–∞—Ü—ñ—ó —ñ—Å–Ω—É—é—á–∏—Ö JSON —Ñ–∞–π–ª—ñ–≤
// –≤ –±–∞–∑—É –¥–∞–Ω–∏—Ö –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ
```

## üöÄ **–ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò**

### 1. **–¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è**
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –¥–µ–ø–æ–∑–∏—Ç–∏
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –≤–∏–≤–µ–¥–µ–Ω–Ω—è
- [ ] –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –¥—É–±–ª—é–≤–∞–Ω–Ω—é

### 2. **–ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥**
- [ ] –î–æ–¥–∞—Ç–∏ –º–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ
- [ ] –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–ª–µ—Ä—Ç–∏
- [ ] –õ–æ–≥—É–≤–∞–Ω–Ω—è –ø–æ–º–∏–ª–æ–∫

### 3. **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**
- [ ] –î–æ–¥–∞—Ç–∏ –∫–µ—à—É–≤–∞–Ω–Ω—è
- [ ] –û–ø—Ç–∏–º—ñ–∑—É–≤–∞—Ç–∏ –∑–∞–ø–∏—Ç–∏
- [ ] –†–æ–∑–≥–ª—è–Ω—É—Ç–∏ PostgreSQL –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

## üìã **–ö–û–ú–ê–ù–î–ò –î–õ–Ø –¢–ï–°–¢–£–í–ê–ù–ù–Ø**

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞
npm run start:prod

# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
sqlite3 database/main.db ".tables"
sqlite3 database/main.db "SELECT * FROM balances LIMIT 5;"
sqlite3 database/main.db "SELECT * FROM transactions LIMIT 5;"
```

## üéØ **–†–ï–ó–£–õ–¨–¢–ê–¢**

‚úÖ **–õ–æ–≥—ñ–∫–∞ –±–∞–ª–∞–Ω—Å—ñ–≤ —Ç–µ–ø–µ—Ä –ø—Ä–∞—Ü—é—î —è–∫ –≥–æ–¥–∏–Ω–Ω–∏–∫!**
- –ù–µ–º–∞—î –¥—É–±–ª—é–≤–∞–Ω–Ω—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- –ê—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- –ù–∞–¥—ñ–π–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è race conditions
- –ü–æ–∫—Ä–∞—â–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –¥–æ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É!** üöÄ
